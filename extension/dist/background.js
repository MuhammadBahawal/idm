var Z="com.mydm.native";var $=["video/","audio/"],ee=new Set(["zip","rar","7z","tar","gz","bz2","xz","iso","exe","msi","dmg","deb","rpm","apk","pdf","doc","docx","xls","xlsx","ppt","pptx","txt","csv","mp4","mkv","avi","mov","wmv","flv","webm","m4v","mp3","flac","wav","aac","ogg","wma","m4a","jpg","jpeg","png","gif","bmp","svg","webp"]),y=null,U="",v=new Map,g=new Map,te={17:{qualityLabel:"144p",height:144,hasVideo:!0,hasAudio:!0,muxed:!0},18:{qualityLabel:"360p",height:360,hasVideo:!0,hasAudio:!0,muxed:!0},22:{qualityLabel:"720p",height:720,hasVideo:!0,hasAudio:!0,muxed:!0},37:{qualityLabel:"1080p",height:1080,hasVideo:!0,hasAudio:!0,muxed:!0},38:{qualityLabel:"2160p",height:2160,hasVideo:!0,hasAudio:!0,muxed:!0},43:{qualityLabel:"360p",height:360,hasVideo:!0,hasAudio:!0,muxed:!0},44:{qualityLabel:"480p",height:480,hasVideo:!0,hasAudio:!0,muxed:!0},45:{qualityLabel:"720p",height:720,hasVideo:!0,hasAudio:!0,muxed:!0},46:{qualityLabel:"1080p",height:1080,hasVideo:!0,hasAudio:!0,muxed:!0},59:{qualityLabel:"480p",height:480,hasVideo:!0,hasAudio:!0,muxed:!0},78:{qualityLabel:"480p",height:480,hasVideo:!0,hasAudio:!0,muxed:!0},133:{qualityLabel:"240p",height:240,hasVideo:!0,hasAudio:!1,muxed:!1},134:{qualityLabel:"360p",height:360,hasVideo:!0,hasAudio:!1,muxed:!1},135:{qualityLabel:"480p",height:480,hasVideo:!0,hasAudio:!1,muxed:!1},136:{qualityLabel:"720p",height:720,hasVideo:!0,hasAudio:!1,muxed:!1},137:{qualityLabel:"1080p",height:1080,hasVideo:!0,hasAudio:!1,muxed:!1},140:{qualityLabel:"Audio",height:0,hasVideo:!1,hasAudio:!0,muxed:!1},160:{qualityLabel:"144p",height:144,hasVideo:!0,hasAudio:!1,muxed:!1},247:{qualityLabel:"720p",height:720,hasVideo:!0,hasAudio:!1,muxed:!1},248:{qualityLabel:"1080p",height:1080,hasVideo:!0,hasAudio:!1,muxed:!1},249:{qualityLabel:"Audio",height:0,hasVideo:!1,hasAudio:!0,muxed:!1},250:{qualityLabel:"Audio",height:0,hasVideo:!1,hasAudio:!0,muxed:!1},251:{qualityLabel:"Audio",height:0,hasVideo:!1,hasAudio:!0,muxed:!1},298:{qualityLabel:"720p60",height:720,hasVideo:!0,hasAudio:!1,muxed:!1},299:{qualityLabel:"1080p60",height:1080,hasVideo:!0,hasAudio:!1,muxed:!1},303:{qualityLabel:"1080p60",height:1080,hasVideo:!0,hasAudio:!1,muxed:!1},313:{qualityLabel:"2160p",height:2160,hasVideo:!0,hasAudio:!1,muxed:!1},315:{qualityLabel:"2160p60",height:2160,hasVideo:!0,hasAudio:!1,muxed:!1}};async function re(e){try{let t=new URL(e),r=await chrome.cookies.getAll({url:t.origin});return r.length===0?"":r.map(o=>`${o.name}=${o.value}`).join("; ")}catch{return""}}async function I(e,t){let r={...t||{}},o=await re(e);return o&&(r.Cookie=o),r}function k(){return new Date().toISOString()}function _(e){return e instanceof Error?e.message:String(e)}function d(e,t,r={}){let o={ts:k(),level:e,event:t,...r};e==="error"?console.error("[MyDM]",t,r):e==="warn"?console.warn("[MyDM]",t,r):console.log("[MyDM]",t,r),chrome.storage.local.get(["debugLogs"],a=>{let n=a.debugLogs||[];n.push(o),chrome.storage.local.set({debugLogs:n.slice(-300),lastDebugLogAt:Date.now()})})}function x(e,t=""){chrome.storage.local.set({connectionStatus:e,disconnectReason:t,lastConnectionStateAt:Date.now()})}function C(e){let t=e.payload;return t&&typeof t=="object"?t:void 0}function oe(e){let r=C(e)?.requestId;return typeof r=="string"?r:void 0}function ne(e){if(e.type==="error"){let r=C(e)?.message;return typeof r=="string"&&r.trim().length>0?r:"Native host returned an error"}}function ie(e){for(let[t,r]of v.entries())clearTimeout(r.timer),r.resolve({success:!1,error:e,requestId:t});v.clear()}function ae(e){let t=oe(e),r=ne(e);if(d("info","native.message",{requestId:t,type:e.type??"unknown"}),chrome.storage.local.set({lastNativeResponse:e,lastNativeResponseAt:Date.now()}),!t)return;let o=v.get(t);o&&(clearTimeout(o.timer),v.delete(t),o.resolve({success:!r,error:r,response:e,requestId:t}))}function se(){let e=chrome.runtime.lastError?.message||"Native host disconnected";d("warn","native.disconnected",{reason:e}),U=e,y=null,x("disconnected",e),ie(e)}function ue(){if(y)return y;x("connecting");try{return y=chrome.runtime.connectNative(Z),y.onMessage.addListener(ae),y.onDisconnect.addListener(se),U="",x("connected"),d("info","native.connected"),y}catch(e){let t=_(e);return d("error","native.connect_failed",{reason:t}),U=t,x("error",t),y=null,null}}function q(e,t){let r=ue();if(!r)return Promise.resolve({success:!1,error:U||"Native host not available. Is MyDM desktop app running?"});let o=typeof crypto<"u"&&typeof crypto.randomUUID=="function"?crypto.randomUUID():`${Date.now()}-${Math.random().toString(16).slice(2)}`,a={type:e,payload:{...t,requestId:o,source:"extension-background",sentAt:k()}};return new Promise(n=>{let i=setTimeout(()=>{v.delete(o),n({success:!1,error:"Timed out waiting for native host response",requestId:o})},15e3);v.set(o,{resolve:n,timer:i});try{r.postMessage(a),d("info","native.request_sent",{requestId:o,type:e})}catch(s){clearTimeout(i),v.delete(o),n({success:!1,error:`Failed to send request: ${_(s)}`,requestId:o})}})}function Y(e,t){return new Promise((r,o)=>{let a={url:e};t&&(a.filename=t.replace(/[/\\]/g,"_")),chrome.downloads.download(a,n=>{if(chrome.runtime.lastError){o(new Error(chrome.runtime.lastError.message));return}if(typeof n!="number"){o(new Error("Download did not start"));return}d("info","download.chrome_fallback_started",{downloadId:n,url:e.substring(0,100),filename:t}),r(n)})})}async function P(){return q("healthcheck",{})}function ce(e){try{let r=new URL(e).pathname.split("/").pop()||"",o=r.lastIndexOf(".");return o<=0?null:r.slice(o+1).toLowerCase()}catch{return null}}function X(e){let t=ce(e);return t!==null&&ee.has(t)}function j(e,t){let r=e.searchParams.get(t);if(!r)return;let o=Number.parseInt(r,10);return Number.isFinite(o)?o:void 0}function le(e){if(!e)return 0;let t=e.match(/(\d{3,4})p/i);if(!t)return 0;let r=Number.parseInt(t[1],10);return Number.isFinite(r)?r:0}function de(e){let t=e.toLowerCase();return t.includes("googlevideo.com")||t.endsWith("youtube.com")||t==="youtu.be"||t.endsWith("youtube-nocookie.com")}function R(e){try{let r=new URL(e).hostname.toLowerCase();return r.includes("googlevideo.com")?!1:r.endsWith("youtube.com")||r==="youtu.be"||r==="m.youtube.com"||r.endsWith("youtube-nocookie.com")}catch{return!1}}function L(e){try{return new URL(e).hostname.toLowerCase().includes("googlevideo.com")}catch{return!1}}function W(e){let t=e.tab?.url;return typeof t=="string"&&R(t)?t:null}function z(e){let t;try{t=new URL(e)}catch{return null}let r=t.hostname.toLowerCase();if(!(r.endsWith("youtube.com")||r==="youtu.be"||r==="m.youtube.com"||r.endsWith("youtube-nocookie.com")))return null;let o=i=>`https://www.youtube.com/watch?v=${encodeURIComponent(i)}`,a=()=>t.pathname.split("/").filter(Boolean)[0]||"",n=()=>t.pathname.split("/").filter(Boolean)[1]||"";if(r==="youtu.be"){let i=a();return i?o(i):null}if(t.pathname==="/redirect"){let i=t.searchParams.get("q");return i?z(i):null}if(t.pathname==="/watch"){let i=t.searchParams.get("v");return i?o(i):null}if(t.pathname.startsWith("/shorts/")||t.pathname.startsWith("/embed/")||t.pathname.startsWith("/live/")){let i=n();return i?o(i):null}return t.toString()}function A(e,t){let r=e.response&&typeof e.response=="object"?C(e.response):void 0;return{success:e.success,error:e.error,requestId:e.requestId||t,nativeType:e.response?.type??"",outputPath:typeof r?.outputPath=="string"?r.outputPath:"",fileName:typeof r?.fileName=="string"?r.fileName:"",runner:typeof r?.runner=="string"?r.runner:"",mode:typeof r?.mode=="string"?r.mode:""}}async function E(e,t,r){let o=r.tab,a=z(e)||e,n=t.detectedVideoUrl||t.url||t.videoUrl||"",i=t.clickTsIso||k(),s=await I(a,t.headers||{});return d("info","gui.youtube.download.request",{clickTsIso:i,tabId:o?.id,tabUrl:o?.url||"",pageUrl:t.pageUrl||o?.url||"",detectedVideoUrl:n,canonicalYoutubeUrl:a,hasCookieHeader:!!s.Cookie,cookieLength:s.Cookie?.length||0,userAgent:s["User-Agent"]||"",referer:o?.url||a}),q("add_youtube_download",{videoUrl:a,filename:t.filename,title:t.title||o?.title||"",quality:t.quality||"",referrer:o?.url||a,headers:s,pageUrl:t.pageUrl||o?.url||"",clickTsIso:i,detectedVideoUrl:n,canonicalYoutubeUrl:a,requestSource:t.streamSource||"gui-overlay"})}function G(e){return(e||"unknown").toLowerCase()}function T(e){let t=G(e);return t==="webrequest"?95e4:t==="fetch"||t==="xhr"?9e5:t.endsWith("_api")?5e5:t==="json_parse"||t==="json_parse_nested"?45e4:t==="global_var"||t==="ytplayer_config"||t==="player_api"?35e4:15e4}function he(e){let t=j(e,"expire");if(t===void 0)return!0;let r=Math.floor(Date.now()/1e3),o=r+7*24*60*60,a=r-24*60*60;return t>=a&&t<=o}var S=new Map;function Q(e,t,r,o){if(t<0)return null;let a;try{a=new URL(e)}catch{return null}let n=a.hostname.toLowerCase(),i=de(n),s=G(o),u=j(a,"itag"),l=u!==void 0?te[u]:void 0,h=a.searchParams.get("mime"),m=h||r||void 0,c=l?.qualityLabel||a.searchParams.get("quality_label")||a.searchParams.get("quality")||void 0,b=l?.height||le(c),f=l?.hasVideo??!1,p=l?.hasAudio??!1;if(!l&&m){let w=m.toLowerCase();w.startsWith("video/")&&(f=!0),w.startsWith("audio/")&&(p=!0)}let V=i&&a.pathname.includes("/videoplayback");if(V&&!f&&!p)if(h){let w=decodeURIComponent(h).toLowerCase();w.startsWith("video/")?f=!0:w.startsWith("audio/")?p=!0:f=!0}else f=!0;let O=!!(m||a.searchParams.get("clen")||a.searchParams.get("dur")||a.searchParams.get("mime"));if(i&&a.pathname.includes("/videoplayback")&&!he(a))return null;let H=r?$.some(w=>r.toLowerCase().startsWith(w)):!1;return!f&&!p&&!O&&!H&&!V||!i&&!X(e)&&!O&&!H?null:{url:e,tabId:t,timestamp:Date.now(),host:n,source:s,mimeType:m,itag:u,qualityLabel:c,height:b,hasVideo:f,hasAudio:p,muxed:l?.muxed??(f&&p)}}function J(e){let t=g.get(e.tabId)||[],r=t.findIndex(o=>o.url===e.url);if(r>=0){let o=t[r],a=T(o.source);if(T(e.source)<=a)return;t[r]=e,t.sort((i,s)=>s.timestamp-i.timestamp),g.set(e.tabId,t.slice(0,300)),D();return}t.push(e),t.sort((o,a)=>a.timestamp-o.timestamp),g.set(e.tabId,t.slice(0,300)),D()}function D(){let e={};g.forEach((t,r)=>{e[String(r)]=t}),chrome.storage.session?.set({_streamCandidates:e}).catch(()=>{})}async function me(){try{let t=(await chrome.storage.session?.get("_streamCandidates"))?._streamCandidates;if(!t)return;for(let[r,o]of Object.entries(t)){let a=Number(r);!isNaN(a)&&Array.isArray(o)&&g.set(a,o)}d("info","stream_candidates.restored",{tabs:Object.keys(t).length,total:[...g.values()].reduce((r,o)=>r+o.length,0)})}catch{}}me();function F(e,t){let r=T(e.source),o=t&&e.muxed?1e6:0,a=t&&e.hasAudio?25e4:0,n=e.hasVideo?1e5:0,i=e.height*1e3,s=Math.floor(e.timestamp/1e3);return r+o+a+n+i+s}function fe(e,t){return[...e].sort((r,o)=>F(o,t)-F(r,t))}function N(e,t){if(!t)return e;try{let o=new URL(t).hostname.toLowerCase();if(o.includes("youtube.com")||o==="youtu.be"||o==="m.youtube.com"){let a=e.filter(n=>n.host.includes("googlevideo.com"));if(a.length>0)return a}return e}catch{return e}}function ge(e,t,r=!0){let o=g.get(e)||[];if(o.length===0)return null;let a=N(o.filter(i=>i.hasVideo||i.muxed),t);return a.length===0?null:fe(a,r)[0]||null}function B(e,t){let r=g.get(e)||[];if(r.length===0)return null;let o=N(r.filter(n=>n.hasAudio&&!n.hasVideo),t);if(o.length===0)return null;let a=[251,250,249,140];for(let n of a){let i=o.find(s=>s.itag===n);if(i)return i}return o.sort((n,i)=>i.timestamp-n.timestamp)[0]||null}function K(e){chrome.storage.local.get(["detectedMedia"],t=>{let r=t.detectedMedia||[];r.some(a=>a.url===e.url&&a.type===e.type&&a.tabId===e.tabId)||(r.push(e),chrome.storage.local.set({detectedMedia:r.slice(-100)}))})}function M(e){chrome.storage.local.get(["detectedResources"],t=>{let r=t.detectedResources||[];r.some(a=>a.url===e.url&&a.kind===e.kind&&a.tabId===e.tabId)||(r.push(e),chrome.storage.local.set({detectedResources:r.slice(-200)}))})}function pe(){chrome.contextMenus.removeAll(()=>{chrome.contextMenus.create({id:"mydm-download",title:"Download with MyDM",contexts:["link","image","video","audio"]}),chrome.contextMenus.create({id:"mydm-download-page",title:"Download page URL with MyDM",contexts:["page"]})})}chrome.runtime.onInstalled.addListener(()=>{pe(),P(),ye()});chrome.runtime.onStartup.addListener(()=>{P()});async function ye(){try{await chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[1,2]}),await chrome.declarativeNetRequest.updateDynamicRules({addRules:[{id:1,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,requestHeaders:[{header:"Referer",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:"https://www.youtube.com/"}]},condition:{urlFilter:"*://*.googlevideo.com/*",resourceTypes:[chrome.declarativeNetRequest.ResourceType.XMLHTTPREQUEST,chrome.declarativeNetRequest.ResourceType.MEDIA,chrome.declarativeNetRequest.ResourceType.OTHER]}},{id:2,priority:1,action:{type:chrome.declarativeNetRequest.RuleActionType.MODIFY_HEADERS,requestHeaders:[{header:"Origin",operation:chrome.declarativeNetRequest.HeaderOperation.SET,value:"https://www.youtube.com"}]},condition:{urlFilter:"*://*.googlevideo.com/*",resourceTypes:[chrome.declarativeNetRequest.ResourceType.XMLHTTPREQUEST,chrome.declarativeNetRequest.ResourceType.MEDIA,chrome.declarativeNetRequest.ResourceType.OTHER]}}]}),d("info","header_rules.installed",{rules:2})}catch(r){d("error","header_rules.install_failed",{error:_(r)})}}chrome.tabs.onRemoved.addListener(e=>{g.delete(e),D()});chrome.contextMenus.onClicked.addListener((e,t)=>{let r=e.linkUrl||e.srcUrl||e.pageUrl;if(r){if(R(r)){d("warn","context_menu.youtube_page_blocked",{url:r});return}q("add_download",{url:r,referrer:t?.url||"",filename:e.selectionText||void 0})}});chrome.runtime.onMessage.addListener((e,t,r)=>{let o=e.requestId||(typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}-${Math.random()}`);return d("info","runtime.message",{requestId:o,type:e.type}),(async()=>{try{switch(e.type){case"download_with_mydm":{if(!e.url){r({success:!1,error:"Missing URL",requestId:o});return}let n=W(t),i=R(e.url)||L(e.url),s=!!e.youtubeUrl||!!e.canonicalYoutubeUrl||e.streamSource==="gui-overlay",u=n&&(i||s)?n:R(e.url)?e.url:"";if(u){let c=await E(u,e,t);r(A(c,o));return}let l=t.tab,h=await I(e.url,e.headers||{}),m=await q("add_download",{url:e.url,filename:e.filename,referrer:l?.url||"",headers:h});if(m.success){r({success:!0,error:m.error,requestId:m.requestId||o});return}if(L(e.url)||n||e.streamSource==="gui-overlay"){r({success:!1,error:m.error||"MyDM native host is required for YouTube stream downloads",requestId:m.requestId||o});return}d("info","download.fallback_chrome",{requestId:o,url:e.url.substring(0,100),nativeError:m.error});try{let c=await Y(e.url,e.filename);r({success:!0,requestId:o,downloadId:c})}catch(c){r({success:!1,error:`Download failed: ${_(c)}`,requestId:o})}return}case"download_youtube":{let n=e.youtubeUrl||e.url||"";if(!n){r({success:!1,error:"Missing YouTube URL",requestId:o});return}if(!R(n)){r({success:!1,error:"Invalid YouTube page URL",requestId:o});return}let i=await E(n,e,t);r(A(i,o));return}case"download_media":{if(!e.manifestUrl){r({success:!1,error:"Missing manifestUrl",requestId:o});return}let n=t.tab,i=await I(e.manifestUrl,e.headers||{}),s=await q("add_media_download",{manifestUrl:e.manifestUrl,mediaType:e.mediaType||"hls",quality:e.quality,title:e.title||n?.title||"",referrer:n?.url||"",headers:i});r({success:s.success,error:s.error,requestId:s.requestId||o});return}case"download_video":{if(!e.videoUrl){r({success:!1,error:"Missing videoUrl",requestId:o});return}let n=W(t);if(n){let l=await E(n,e,t);r(A(l,o));return}let i=t.tab,s=await I(e.videoUrl,e.headers||{}),u=await q("add_video_download",{videoUrl:e.videoUrl,audioUrl:e.audioUrl||"",filename:e.filename,quality:e.quality,title:e.title||i?.title||"",referrer:i?.url||"",headers:s});if(u.success){r({success:!0,error:u.error,requestId:u.requestId||o});return}if(L(e.videoUrl)){r({success:!1,error:u.error||"MyDM native host is required for YouTube stream downloads",requestId:u.requestId||o});return}d("info","download_video.fallback_chrome",{requestId:o,videoUrl:e.videoUrl.substring(0,100),nativeError:u.error});try{let l=await Y(e.videoUrl,e.filename);r({success:!0,requestId:o,downloadId:l})}catch(l){r({success:!1,error:`Download failed: ${_(l)}`,requestId:o})}return}case"get_connection_status":{let n=await P();r({connected:n.success,disconnectReason:n.success?"":n.error||U,requestId:n.requestId||o});return}case"resolve_video_source":{let n=t.tab?.id;if(typeof n!="number"){r({success:!1,error:"Cannot resolve source without tab context",requestId:o});return}let i=e.pageUrl||t.tab?.url||"",s=e.preferMuxed!==!1,u=ge(n,i,s);if(!u){r({success:!1,error:"No downloadable stream detected yet. Let the video play for a few seconds and try again.",requestId:o});return}let l="";if(!u.muxed&&u.hasVideo){let h=B(n,i);h&&(l=h.url)}d("info","stream.resolved",{requestId:o,tabId:n,pageUrl:i,url:u.url,audioUrl:l||void 0,itag:u.itag,quality:u.qualityLabel,muxed:u.muxed}),r({success:!0,requestId:o,url:u.url,audioUrl:l,quality:u.qualityLabel||"",mimeType:u.mimeType||"",muxed:u.muxed});return}case"list_stream_qualities":{let n=t.tab?.id;if(typeof n!="number"){r({success:!1,error:"No tab context",requestId:o});return}let i=e.pageUrl||t.tab?.url||"",s=g.get(n)||[],u=N(s,i),l=new Set,h=[],m=[...u].sort((c,b)=>c.muxed!==b.muxed?c.muxed?-1:1:b.height-c.height);for(let c of m){if(!c.hasVideo)continue;let b=`${c.qualityLabel||c.height}-${c.muxed?"m":"s"}`;if(l.has(b))continue;l.add(b);let f="";if(!c.muxed){let p=B(n,i);p&&(f=p.url)}h.push({url:c.url,audioUrl:f,itag:c.itag,quality:c.qualityLabel||`${c.height}p`,mimeType:c.mimeType||"",muxed:c.muxed,height:c.height,hasVideo:c.hasVideo,hasAudio:c.hasAudio})}d("info","stream.list_qualities",{tabId:n,count:h.length,qualities:h.map(c=>c.quality)}),r({success:!0,requestId:o,qualities:h});return}case"detected_media":{e.url&&K({url:e.url,type:e.mediaType||"unknown",tabId:t.tab?.id,title:t.tab?.title||"",timestamp:Date.now()}),r({success:!0,requestId:o});return}case"detected_resources":{let n=e.resources||[];for(let i of n){let s=i.url,u=i.kind;typeof s!="string"||typeof u!="string"||M({...i,tabId:t.tab?.id,title:t.tab?.title||"",timestamp:Date.now()})}r({success:!0,requestId:o,count:n.length});return}case"report_stream_url":{let n=e.url,i=t.tab?.id;if(typeof n=="string"&&typeof i=="number"){let s=Q(n,i,void 0,e.streamSource);s?(J(s),d("info","stream.accepted",{tabId:i,url:n.substring(0,100),source:s.source,itag:s.itag,quality:s.qualityLabel,muxed:s.muxed,hasVideo:s.hasVideo,hasAudio:s.hasAudio})):d("warn","stream.rejected_by_filter",{tabId:i,url:n.substring(0,120),source:e.streamSource||"unknown"})}r({success:!0,requestId:o});return}default:{r({success:!1,error:`Unsupported message type: ${e.type}`,requestId:o});return}}}catch(n){let i=_(n);d("error","runtime.message_failed",{requestId:o,type:e.type,error:i}),r({success:!1,error:i,requestId:o})}})(),!0});chrome.webRequest&&(chrome.webRequest.onHeadersReceived.addListener(e=>{if(e.responseHeaders){for(let t of e.responseHeaders)if(t.name.toLowerCase()==="content-type"&&t.value){let r=t.value.toLowerCase();$.some(o=>r.startsWith(o))&&S.set(e.requestId,t.value);break}}},{urls:["<all_urls>"],types:["xmlhttprequest","media","other"]},["responseHeaders"]),chrome.webRequest.onCompleted.addListener(e=>{let t=e.url.toLowerCase(),r=S.get(e.requestId);if(S.delete(e.requestId),t.includes(".m3u8")||t.includes(".mpd")){let a=t.includes(".m3u8")?"hls":"dash";K({url:e.url,type:a,tabId:e.tabId,timestamp:Date.now()})}else X(e.url)&&M({url:e.url,kind:"network_file",tabId:e.tabId,timestamp:Date.now()});let o=Q(e.url,e.tabId,r,"webrequest");o&&(J(o),o.hasVideo&&M({url:o.url,kind:o.muxed?"network_video_muxed":"network_video_stream",tabId:e.tabId,timestamp:o.timestamp}))},{urls:["<all_urls>"],types:["xmlhttprequest","media","main_frame","sub_frame","other"]}));
