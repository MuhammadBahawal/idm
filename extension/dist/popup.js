document.addEventListener("DOMContentLoaded",()=>{let a=document.getElementById("statusDot"),n=document.getElementById("statusText"),s=document.getElementById("mediaList"),o=document.getElementById("urlInput"),i=document.getElementById("addBtn"),r=document.getElementById("optionsLink");chrome.runtime.sendMessage({type:"get_connection_status"},e=>{e?.connected?(a?.classList.add("connected"),n&&(n.textContent="Connected to MyDM")):n&&(n.textContent="Not connected \u2014 is MyDM running?")}),chrome.storage.local.get(["detectedMedia"],e=>{let c=e.detectedMedia||[];if(c.length!==0&&s){s.innerHTML="";let l=c.slice(-10).reverse();for(let t of l){let d=document.createElement("div");d.className="media-item",d.innerHTML=`
          <span class="media-type ${t.type||""}">${t.type||"unknown"}</span>
          <span class="media-title">${t.title||t.url||"Unknown"}</span>
        `,d.addEventListener("click",()=>{chrome.runtime.sendMessage({type:"download_media",manifestUrl:t.url,mediaType:t.type,title:t.title}),window.close()}),s.appendChild(d)}}}),i?.addEventListener("click",()=>{let e=o?.value?.trim();e&&(chrome.runtime.sendMessage({type:"download_with_mydm",url:e}),window.close())}),o?.addEventListener("keydown",e=>{e.key==="Enter"&&i?.click()}),r?.addEventListener("click",e=>{e.preventDefault(),chrome.runtime.openOptionsPage()})});
